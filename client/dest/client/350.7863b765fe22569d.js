"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[350],{8350:(H,v,l)=>{l.r(v),l.d(v,{AuthModule:()=>G});var f=l(6895),p=l(1779),r=l(4006),x=l(9646),m=l(8505),b=l(5032),a=l(5755),h=l(868),t=l(4650),g=l(4728),Z=l(1261),T=l(529);let A=(()=>{class n{constructor(e){this.http=e,this.baseUrl=Z.N.apiUrl}login(e){return this.http.post(this.baseUrl+"Account/Login",e)}registerUser(e){return this.http.post(this.baseUrl+"Account/Register",e)}sendOtp(e){return this.http.post(this.baseUrl+"Account/SendOtp",e)}verifyOtp(e){return this.http.post(this.baseUrl+"Account/VerifyOTP",e)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(T.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function _(n,i){if(1&n&&(t.TgZ(0,"div",4),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.label," is required ")}}function M(n,i){1&n&&(t.TgZ(0,"div",4),t._uU(1," Please enter a valid Email "),t.qZA())}let C=(()=>{class n{constructor(e){this.ngControl=e,this.label="",this.type="text",this.readOnly=!1,this.ngControl.valueAccessor=this}writeValue(e){}registerOnChange(e){}registerOnTouched(e){}get control(){return this.ngControl.control}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(r.a5,2))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-input"]],inputs:{label:"label",type:"type",readOnly:"readOnly"},decls:6,vars:9,consts:[[1,"form-group","m-2"],[1,"form-label"],[1,"form-control","w-100",3,"type","placeholder","readonly","formControl"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"label",1),t._uU(2),t.qZA(),t._UZ(3,"input",2),t.YNc(4,_,2,1,"div",3),t.YNc(5,M,2,0,"div",3),t.qZA()),2&e&&(t.xp6(2),t.Oqu(o.label),t.xp6(1),t.ekj("is-invalid",o.control.touched&&o.control.invalid),t.Q6J("type",o.type)("placeholder",o.label)("readonly",o.readOnly)("formControl",o.control),t.xp6(1),t.Q6J("ngIf",null==o.control.errors?null:o.control.errors.required),t.xp6(1),t.Q6J("ngIf",null==o.control.errors?null:o.control.errors.email))},dependencies:[f.O5,r.Fj,r.JJ,r.oH],styles:[".error-message[_ngcontent-%COMP%]{font-size:10px;color:red}.mat-form-field[_ngcontent-%COMP%]{height:10%}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.form-label[_ngcontent-%COMP%]{font-weight:700;margin:0}.form-control[_ngcontent-%COMP%]{outline:1px solid lightgray}"]}),n})(),O=(()=>{class n{constructor(e,o,s){this.fb=e,this.bsModalRef=o,this.authHttpService=s,this.form=new r.cw({})}ngOnInit(){this.form=this.fb.group({otp:["",[r.kI.required]]})}verifyOtp(){const e={...this.form.value};this.authHttpService.verifyOtp(e).subscribe({next:o=>{!0===o.status?this.bsModalRef.hide():(0,h.A)("Wrong OTP! Please enter a valid OTP!")}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(r.qu),t.Y36(g.UZ),t.Y36(A))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-verify-otp"]],decls:9,vars:3,consts:[[1,"container"],[3,"formGroup","ngSubmit"],[1,"row"],[1,"col-12"],[3,"formControl","label"],[1,"col-12","d-flex","justify-content-center","align-items-center","p-2"],[1,"btn","btn-primary"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"form",1),t.NdJ("ngSubmit",function(){return o.verifyOtp()}),t.TgZ(2,"div",2)(3,"div",3),t._UZ(4,"app-input",4),t.qZA()(),t.TgZ(5,"div",2)(6,"div",5)(7,"button",6),t._uU(8,"VERIFY OTP"),t.qZA()()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(3),t.Q6J("formControl",o.form.controls.otp)("label","OTP"))},dependencies:[C,r._Y,r.JJ,r.JL,r.oH,r.sg]}),n})();var c=l(9653);const S=["timerSpan"];function J(n,i){1&n&&(t.ynx(0),t._UZ(1,"span",null,15),t.BQk())}function U(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",3),t._UZ(2,"app-input",4),t.qZA(),t.TgZ(3,"div",3),t._UZ(4,"app-input",4),t.qZA(),t.TgZ(5,"div",3),t._UZ(6,"app-input",4),t.qZA(),t.TgZ(7,"div",3)(8,"div",2)(9,"div",3)(10,"div",8)(11,"div",2)(12,"div",9)(13,"label",10),t._uU(14,"Mobile No"),t.qZA()(),t.TgZ(15,"div",11),t._UZ(16,"input",12),t.qZA(),t.TgZ(17,"div",13)(18,"button",14),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.sendOtp())}),t._uU(19,"OTP"),t.qZA(),t.YNc(20,J,3,0,"ng-container",5),t.qZA()()()()()(),t.TgZ(21,"div",3),t._UZ(22,"app-input",4),t.qZA(),t.TgZ(23,"div",3),t._UZ(24,"app-input",4),t.qZA(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("formControl",e.form.controls.nic)("label","NIC"),t.xp6(2),t.Q6J("formControl",e.form.controls.email)("label","Email"),t.xp6(2),t.Q6J("formControl",e.form.controls.custAddress)("label","Address"),t.xp6(12),t.Q6J("disabled",e.otpSent),t.xp6(2),t.Q6J("ngIf",e.otpSent),t.xp6(2),t.Q6J("formControl",e.form.controls.alternatePhone)("label","Alternate Mobile No"),t.xp6(2),t.Q6J("formControl",e.form.controls.contactNo)("label","Contact No")}}function I(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",16),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onSubmit())}),t._uU(2,"Login"),t.qZA(),t.TgZ(3,"p"),t._uU(4,"Don't have an Account? "),t.TgZ(5,"span",17),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.toggleRegisterMode())}),t._uU(6,"Register"),t.qZA()(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("disabled",e.isDisabled||e.form.invalid)}}function w(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",16),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onSubmit())}),t._uU(2,"Register"),t.qZA(),t.TgZ(3,"p"),t._uU(4,"Already have an Account? "),t.TgZ(5,"span",17),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.toggleRegisterMode())}),t._uU(6,"Login"),t.qZA()(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("disabled",e.isDisabled||e.form.invalid||e.otpSent)}}const k=[{path:"",component:(()=>{class n{constructor(e,o,s,d,R){this.fb=e,this.router=o,this.store=s,this.authService=d,this.modalService=R,this.form=new r.cw({}),this.registerMode=!1,this.otpSent=!1,this.disabledTime=(0,x.of)(0),this.isDisabled=!1,this.remainingTime=30}ngOnInit(){this.initializeForm()}initializeForm(){this.form=this.fb.group(this.registerMode?{custName:["",[r.kI.required]],nic:["",[]],email:["",[r.kI.required,r.kI.email]],custAddress:["",[r.kI.required]],mobile:["",[r.kI.required]],alternatePhone:["",[r.kI.required]],contactNo:["",[r.kI.required]],custPassword:["",[r.kI.required]]}:{custName:["",[r.kI.required]],custPassword:["",[r.kI.required]]})}onSubmit(){if(this.form.valid)if(this.registerMode){if(this.registerMode){const e={...this.form.value};this.isDisabled=!0,this.authService.registerUser(e).pipe((0,m.b)(o=>{this.isDisabled=!1,this.registerMode=!1})).subscribe({next:b.Z,error:o=>{(0,h.A)(o.error),this.isDisabled=!1}})}}else{const e={username:this.form.value.custName,password:this.form.value.custPassword};this.isDisabled=!0,this.authService.login(e).pipe((0,m.b)(o=>{this.store.dispatch((0,a.x4)({user:o})),this.router.navigate(["/dashboard/home"]).then(()=>{this.isDisabled=!1})})).subscribe({next:b.Z,error:o=>{(0,h.A)(o.error),this.isDisabled=!1}})}}openModalWithComponent(){this.bsModalRef=this.modalService.show(O)}sendOtp(){this.otpSent=!0}toggleRegisterMode(){this.registerMode=!this.registerMode,this.initializeForm()}startTimer(){let e=setInterval(()=>{this.remainingTime--;const o=Math.floor(this.remainingTime/60),s=this.remainingTime%60;console.log(this.remainingTime),this.timerSpan.nativeElement.textContent=`${o.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`,this.remainingTime<=0&&(clearInterval(e),this.otpSent=!1)},1e3)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(r.qu),t.Y36(p.F0),t.Y36(c.yh),t.Y36(A),t.Y36(g.tT))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-auth"]],viewQuery:function(e,o){if(1&e&&t.Gf(S,5),2&e){let s;t.iGM(s=t.CRH())&&(o.timerSpan=s.first)}},decls:11,vars:9,consts:[[1,"container","h-100","flex-container"],[3,"formGroup"],[1,"row"],[1,"col-12"],[3,"formControl","label"],[4,"ngIf"],[3,"formControl","label","type"],[1,"col-12","justify-content-center","align-items-center","d-flex","flex-column","mt-2"],[1,"form-group","m-2"],[1,"col-12","col-sm-12","col-md-12"],[1,"form-label"],[1,"col-12","col-sm-12","col-md-9"],["type","text","placeholder","Country Code + Phone number","formControlName","mobile",1,"form-control","w-100"],[1,"col-12","col-sm-12","col-md-3","text-center"],["type","button",1,"btn","btn-primary","w-100",3,"disabled","click"],["timerSpan",""],[1,"btn","btn-primary","w-50",3,"disabled","click"],[1,"link-danger",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3),t._UZ(4,"app-input",4),t.qZA(),t.YNc(5,U,25,12,"ng-container",5),t.TgZ(6,"div",3),t._UZ(7,"app-input",6),t.qZA(),t.TgZ(8,"div",7),t.YNc(9,I,7,1,"ng-container",5),t.YNc(10,w,7,1,"ng-container",5),t.qZA()()()()),2&e&&(t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(3),t.Q6J("formControl",o.form.controls.custName)("label","Username"),t.xp6(1),t.Q6J("ngIf",o.registerMode),t.xp6(2),t.Q6J("formControl",o.form.controls.custPassword)("label","Password")("type","password"),t.xp6(2),t.Q6J("ngIf",!o.registerMode),t.xp6(1),t.Q6J("ngIf",o.registerMode))},dependencies:[f.O5,C,r._Y,r.Fj,r.JJ,r.JL,r.oH,r.sg,r.u],styles:[".form-field-container[_ngcontent-%COMP%]{margin-bottom:10px}.form-label[_ngcontent-%COMP%]{font-weight:700;margin:0}.form-control[_ngcontent-%COMP%]{outline:1px solid lightgray}.flex-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;max-width:1073px;margin-top:20px}"]}),n})()}];let N=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(k),p.Bz]}),n})();var Q=l(4466),P=l(6354);const y={user:void 0},F=(0,c.Lq)(y,(0,c.on)(a.x4,(n,i)=>({user:i.user})),(0,c.on)(a.kS,(n,i)=>({user:void 0})),(0,c.on)(a.Jo,()=>y));var u=l(493),q=l(5657);let Y=(()=>{class n{constructor(e,o,s){this.actions$=e,this.router=o,this.cookieService=s,this.login$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(a.x4),(0,m.b)(d=>this.cookieService.set("user",JSON.stringify(d.user),{expires:new Date((new Date).getTime()+6048e5)}))),{dispatch:!1}),this.logout$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(a.kS),(0,m.b)(d=>{this.cookieService.delete("user"),this.router.navigateByUrl("/")})),{dispatch:!1})}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(u.eX),t.LFG(p.F0),t.LFG(q.N))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})(),G=(()=>{class n{static forRoot(){return{ngModule:n}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[f.ez,N,Q.m,P.W,r.UX,r.u5,g.zk.forRoot(),c.Aw.forFeature("auth",F),u.sQ.forFeature([Y])]}),n})()}}]);